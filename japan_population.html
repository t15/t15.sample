<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>日本の人口推移</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=DM+Sans:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:       #eef2f7;
    --surface:  #ffffff;
    --ink:      #0d1b2a;
    --navy:     #1b3a5c;
    --navy-mid: #2e6da4;
    --navy-lt:  #5b9bd5;
    --sky:      #a8cde8;
    --accent:   #e05c1a;
    --muted:    #5a6e82;
    --border:   rgba(30,70,120,0.14);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--ink);
    font-family: 'Noto Sans JP', sans-serif;
    min-height: 100vh;
    padding: 48px 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse 80% 50% at 5% 0%, rgba(43,90,150,0.09) 0%, transparent 55%),
      radial-gradient(ellipse 50% 50% at 95% 100%, rgba(30,70,120,0.06) 0%, transparent 55%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 980px;
  }

  /* ── Header ── */
  header {
    margin-bottom: 32px;
    animation: fadeDown 0.8s ease both;
  }

  .eyebrow {
    font-family: 'DM Sans', sans-serif;
    font-size: 11px;
    letter-spacing: 0.45em;
    color: var(--navy-mid);
    text-transform: uppercase;
    font-weight: 400;
    margin-bottom: 8px;
  }

  h1 {
    font-size: clamp(22px, 4vw, 38px);
    font-weight: 700;
    color: var(--navy);
    letter-spacing: 0.04em;
    line-height: 1.2;
  }

  .subtitle {
    font-size: 12px;
    color: var(--muted);
    letter-spacing: 0.18em;
    font-weight: 300;
    margin-top: 6px;
  }

  .header-rule {
    width: 44px;
    height: 3px;
    background: linear-gradient(90deg, var(--navy), var(--navy-lt));
    margin-top: 10px;
    border-radius: 2px;
  }

  /* ── Card ── */
  .chart-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 28px 32px 22px;
    box-shadow: 0 2px 20px rgba(0,40,80,0.07);
    animation: fadeUp 1s ease 0.2s both;
    position: relative;
    overflow: hidden;
  }

  .chart-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--navy) 0%, var(--navy-mid) 55%, var(--navy-lt) 100%);
  }

  /* ── Legend ── */
  .legend-row {
    display: flex;
    flex-wrap: wrap;
    gap: 6px 18px;
    margin-bottom: 18px;
    align-items: center;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--muted);
    font-weight: 400;
  }

  .lg-rect {
    width: 14px; height: 12px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  .lg-rect.hatch-navy {
    background: repeating-linear-gradient(
      -45deg,
      rgba(27,58,92,0.75) 0px, rgba(27,58,92,0.75) 2px,
      rgba(255,255,255,0.5) 2px, rgba(255,255,255,0.5) 5px
    );
    border: 1px solid var(--navy);
  }

  .lg-rect.hatch-sky {
    background: repeating-linear-gradient(
      -45deg,
      rgba(91,155,213,0.75) 0px, rgba(91,155,213,0.75) 2px,
      rgba(255,255,255,0.5) 2px, rgba(255,255,255,0.5) 5px
    );
    border: 1px solid var(--navy-lt);
  }

  .lg-line {
    width: 22px; height: 3px;
    border-radius: 2px;
    flex-shrink: 0;
    background: var(--accent);
  }

  .lg-line.dashed {
    background: none;
    border-top: 2.5px dashed var(--accent);
    height: 0;
    margin-top: 1px;
  }

  .lg-sep {
    width: 1px; height: 14px;
    background: var(--border);
    margin: 0 4px;
  }

  .chart-wrapper {
    position: relative;
    height: 480px;
  }

  .note {
    margin-top: 12px;
    font-size: 10.5px;
    color: var(--muted);
    text-align: right;
    letter-spacing: 0.06em;
    font-weight: 300;
  }

  /* ── Stats ── */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    margin-top: 18px;
    animation: fadeUp 1s ease 0.45s both;
  }

  .stat-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px 14px;
    position: relative;
    overflow: hidden;
  }

  .stat-box::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 3px;
  }
  .stat-box:nth-child(1)::before { background: var(--navy); }
  .stat-box:nth-child(2)::before { background: var(--navy-mid); }
  .stat-box:nth-child(3)::before { background: var(--navy-lt); }
  .stat-box:nth-child(4)::before { background: var(--accent); }

  .stat-value {
    font-family: 'DM Sans', sans-serif;
    font-size: 20px;
    font-weight: 600;
    color: var(--navy);
    display: block;
    letter-spacing: -0.01em;
    line-height: 1.2;
  }

  .stat-label {
    font-size: 10px;
    letter-spacing: 0.1em;
    color: var(--muted);
    margin-top: 5px;
    display: block;
    font-weight: 400;
    line-height: 1.4;
  }

  footer {
    margin-top: 18px;
    font-size: 10.5px;
    color: var(--muted);
    letter-spacing: 0.1em;
    font-weight: 300;
    animation: fadeUp 1s ease 0.6s both;
  }

  @keyframes fadeDown {
    from { opacity: 0; transform: translateY(-14px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  @media (max-width: 640px) {
    .chart-card { padding: 16px; }
    .chart-wrapper { height: 320px; }
    .stats-row { grid-template-columns: repeat(2, 1fr); }
  }
</style>
</head>
<body>
<div class="container">

  <header>
    <p class="eyebrow">Statistics Japan</p>
    <h1>日本の人口・出生数の推移</h1>
    <div class="header-rule"></div>
    <p class="subtitle">1950年〜2070年（推計含む）</p>
  </header>

  <div class="chart-card">

    <div class="legend-row">
      <div class="legend-item">
        <div class="lg-rect" style="background:#1b3a5c;"></div>その他人口（実績）
      </div>
      <div class="legend-item">
        <div class="lg-rect" style="background:#5b9bd5;"></div>生産年齢人口 15〜64歳（実績）
      </div>
      <div class="lg-sep"></div>
      <div class="legend-item">
        <div class="lg-rect hatch-navy"></div>その他人口（推計）
      </div>
      <div class="legend-item">
        <div class="lg-rect hatch-sky"></div>生産年齢人口（推計）
      </div>
      <div class="lg-sep"></div>
      <div class="legend-item">
        <div class="lg-line"></div>出生数（実績）
      </div>
      <div class="legend-item">
        <div class="lg-line dashed"></div>出生数（推計）
      </div>
    </div>

    <div class="chart-wrapper">
      <canvas id="mainChart"></canvas>
    </div>
    <p class="note">左軸：人口（百万人）　右軸：出生数（万人）　※2025年以降は国立社会保障・人口問題研究所 出生中位・死亡中位推計</p>
  </div>

  <div class="stats-row">
    <div class="stat-box">
      <span class="stat-value">128.1M</span>
      <span class="stat-label">ピーク総人口（2008年）</span>
    </div>
    <div class="stat-box">
      <span class="stat-value">87.0M</span>
      <span class="stat-label">2070年推計総人口</span>
    </div>
    <div class="stat-box">
      <span class="stat-value">59.5%→51%</span>
      <span class="stat-label">生産年齢比率<br>1990年→2070年推計</span>
    </div>
    <div class="stat-box">
      <span class="stat-value">75.8万</span>
      <span class="stat-label">出生数（2023年）<br>統計開始以来最低</span>
    </div>
  </div>

  <footer>出典：総務省統計局・厚生労働省 人口動態統計・国立社会保障・人口問題研究所</footer>
</div>

<script>
// ── データ ────────────────────────────────────────────────────
// [year, totalPop(百万人), workingAgePop(百万人), births(万人), isProjection]
const rawData = [
  [1950,  84.1,  49.7, 233.5, false],
  [1955,  89.3,  53.2, 173.0, false],
  [1960,  93.4,  60.1, 160.6, false],
  [1965,  98.3,  64.5, 182.3, false],
  [1970, 103.7,  71.6, 193.4, false],
  [1975, 111.9,  75.8, 190.0, false],
  [1980, 117.1,  78.8, 157.7, false],
  [1985, 121.0,  82.5, 143.2, false],
  [1990, 123.6,  85.9, 122.2, false],
  [1995, 125.6,  87.2, 118.7, false],
  [2000, 126.9,  86.4, 119.1, false],
  [2005, 127.7,  84.4, 106.3, false],
  [2010, 128.1,  81.6, 107.1, false],
  [2015, 127.1,  77.7, 100.6, false],
  [2020, 126.1,  75.1,  84.1, false],
  [2023, 124.4,  73.4,  75.8, false],
  [2025, 123.2,  72.0,  73.0, true],
  [2030, 120.0,  68.0,  68.0, true],
  [2035, 116.6,  63.5,  64.0, true],
  [2040, 112.8,  59.0,  60.0, true],
  [2050, 104.1,  53.0,  52.0, true],
  [2060,  95.6,  48.0,  46.0, true],
  [2070,  87.0,  44.5,  41.0, true],
];

const N            = rawData.length;
const years        = rawData.map(d => d[0]);
const totalPop     = rawData.map(d => d[1]);
const workingAge   = rawData.map(d => d[2]);
const otherPop     = rawData.map((d, i) => parseFloat((d[1] - d[2]).toFixed(2)));
const births       = rawData.map(d => d[3]);
const isProj       = rawData.map(d => d[4]);

// 実績 / 推計 を分け、境界点を共有させる
const bridgeIdx = isProj.findIndex(v => v);  // 最初の推計インデックス

function split(arr) {
  const real = arr.map((v, i) => i < bridgeIdx ? v : (i === bridgeIdx ? arr[bridgeIdx - 1] : null));
  const proj = arr.map((v, i) => i < bridgeIdx - 1 ? null : (i === bridgeIdx - 1 ? arr[bridgeIdx - 1] : v));
  // Note: bridgeIdx-1 = last real point → shared as start of proj line
  return { real, proj };
}

const wa    = split(workingAge);
const other = split(otherPop);
const birth = split(births);

// ── Canvas パターン（斜線）───────────────────────────────────
function hatch(r, g, b, bg_r, bg_g, bg_b) {
  const size = 9;
  const c = document.createElement('canvas');
  c.width = size; c.height = size;
  const p = c.getContext('2d');
  p.fillStyle = `rgba(${bg_r},${bg_g},${bg_b},0.65)`;
  p.fillRect(0, 0, size, size);
  p.strokeStyle = 'rgba(255,255,255,0.45)';
  p.lineWidth = 1.6;
  p.beginPath(); p.moveTo(-1, size + 1); p.lineTo(size + 1, -1); p.stroke();
  p.beginPath(); p.moveTo(-1, 1);        p.lineTo(1, -1);        p.stroke();
  p.beginPath(); p.moveTo(size - 1, size + 1); p.lineTo(size + 1, size - 1); p.stroke();
  const ctx2 = document.getElementById('mainChart').getContext('2d');
  return ctx2.createPattern(c, 'repeat');
}

const mainCtx     = document.getElementById('mainChart').getContext('2d');
const patNavy     = hatch(27, 58, 92,  27, 58, 92);
const patSky      = hatch(91, 155, 213, 91, 155, 213);

new Chart(mainCtx, {
  data: {
    labels: years.map(y => y + '年'),
    datasets: [
      // 積み重ね棒（実績）：2023年まで（bridgeIdx-1 を含む）
      {
        type: 'bar', label: '生産年齢人口・実績',
        data: workingAge.map((v, i) => i <= bridgeIdx - 1 ? v : null),
        backgroundColor: '#5b9bd5',
        stack: 'pop', order: 4, yAxisID: 'yL',
        barPercentage: 0.72, categoryPercentage: 0.82,
      },
      {
        type: 'bar', label: 'その他人口・実績',
        data: otherPop.map((v, i) => i <= bridgeIdx - 1 ? v : null),
        backgroundColor: '#1b3a5c',
        stack: 'pop', order: 4, yAxisID: 'yL',
        barPercentage: 0.72, categoryPercentage: 0.82,
      },
      // 積み重ね棒（推計）：2025年から（bridgeIdx 以降のみ）
      {
        type: 'bar', label: '生産年齢人口・推計',
        data: workingAge.map((v, i) => i >= bridgeIdx ? v : null),
        backgroundColor: patSky,
        borderColor: '#5b9bd5', borderWidth: 1,
        stack: 'pop', order: 4, yAxisID: 'yL',
        barPercentage: 0.72, categoryPercentage: 0.82,
      },
      {
        type: 'bar', label: 'その他人口・推計',
        data: otherPop.map((v, i) => i >= bridgeIdx ? v : null),
        backgroundColor: patNavy,
        borderColor: '#1b3a5c', borderWidth: 1,
        stack: 'pop', order: 4, yAxisID: 'yL',
        barPercentage: 0.72, categoryPercentage: 0.82,
      },
      // 出生数折れ線（実績）
      {
        type: 'line', label: '出生数・実績（万人）',
        data: births.map((v, i) => i <= bridgeIdx - 1 ? v : null),
        borderColor: '#e05c1a', backgroundColor: 'rgba(224,92,26,0.08)',
        borderWidth: 2.5, pointRadius: 4,
        pointBackgroundColor: '#e05c1a', pointBorderColor: '#fff', pointBorderWidth: 2,
        tension: 0.35, order: 1, yAxisID: 'yR', spanGaps: true, fill: false,
      },
      // 出生数折れ線（推計）
      {
        type: 'line', label: '出生数・推計（万人）',
        data: births.map((v, i) => i >= bridgeIdx - 1 ? v : null),
        borderColor: '#e05c1a', backgroundColor: 'transparent',
        borderWidth: 2, borderDash: [5, 4],
        pointRadius: 3,
        pointBackgroundColor: '#e05c1a', pointBorderColor: '#fff', pointBorderWidth: 2,
        tension: 0.35, order: 1, yAxisID: 'yR', spanGaps: true, fill: false,
      },
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    interaction: { mode: 'index', intersect: false },
    plugins: {
      legend: { display: false },
      tooltip: {
        backgroundColor: 'rgba(13,27,42,0.93)',
        titleFont: { family: 'Noto Sans JP', size: 12, weight: '500' },
        bodyFont:  { family: 'Noto Sans JP', size: 11 },
        padding: 14, cornerRadius: 5,
        callbacks: {
          title: items => items[0].label,
          label: item => {
            if (item.parsed.y === null || item.parsed.y === undefined) return null;
            const lb = item.dataset.label;
            const proj = lb.includes('推計') ? '（推計）' : '';
            if (lb.includes('出生数')) return ` 出生数${proj}：${item.parsed.y.toFixed(1)} 万人`;
            if (lb.includes('生産年齢')) return ` 生産年齢人口${proj}：${item.parsed.y.toFixed(1)} 百万人`;
            if (lb.includes('その他')) return ` その他人口${proj}：${item.parsed.y.toFixed(1)} 百万人`;
            return null;
          },
          afterBody: items => {
            const i = items[0].dataIndex;
            const total = totalPop[i];
            const wa2   = workingAge[i];
            const ratio = ((wa2 / total) * 100).toFixed(1);
            return ['', ` 総人口：${total.toFixed(1)} 百万人`, ` 生産年齢比率：${ratio}%`];
          }
        }
      }
    },
    scales: {
      x: {
        stacked: true,
        grid: { color: 'rgba(30,70,120,0.07)', drawTicks: false },
        ticks: {
          font: { family: 'Noto Sans JP', size: 10 },
          color: '#5a6e82',
          maxRotation: 45, autoSkip: true, maxTicksLimit: 14,
        },
        border: { color: 'rgba(30,70,120,0.12)' }
      },
      yL: {
        type: 'linear', position: 'left', stacked: true,
        min: 0, max: 160,
        grid: { color: 'rgba(30,70,120,0.07)', drawTicks: false },
        ticks: {
          font: { family: 'Noto Sans JP', size: 10 },
          color: '#5a6e82',
          callback: v => v + ' M',
        },
        title: {
          display: true, text: '人口（百万人）',
          font: { family: 'Noto Sans JP', size: 10 }, color: '#5a6e82',
        },
        border: { color: 'transparent', dash: [3, 3] }
      },
      yR: {
        type: 'linear', position: 'right',
        min: 0, max: 290,
        grid: { display: false },
        ticks: {
          font: { family: 'Noto Sans JP', size: 10 },
          color: '#e05c1a',
          callback: v => v + ' 万',
        },
        title: {
          display: true, text: '出生数（万人）',
          font: { family: 'Noto Sans JP', size: 10 }, color: '#e05c1a',
        },
        border: { color: 'rgba(224,92,26,0.2)' }
      }
    }
  }
});
</script>
</body>
</html>
